<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homebrew DND Quick Reference</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="popup.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="popup-container">
    <!-- Header -->
    <header class="popup-header">
      <div class="logo">
        <img src="../icons/icon48.png" alt="" class="logo-icon">
        <span class="logo-text">Homebrew DND</span>
      </div>
      <button class="btn-icon" id="openPanelBtn" title="Open Full Panel (Ctrl+Shift+H)">
        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 7h7v2H7zm0 4h10v2H7zm0 4h10v2H7z"/>
        </svg>
      </button>
    </header>

    <!-- Search Section -->
    <section class="search-section">
      <div class="search-wrapper">
        <input 
          type="text" 
          class="search-input" 
          id="searchInput" 
          placeholder="Search items, equipment..."
          autocomplete="off"
        >
      </div>
      <div class="search-results" id="searchResults">
        <!-- Results populated by JS -->
      </div>
    </section>

    <!-- Quick Dice Roller -->
    <section class="dice-section">
      <h3 class="section-title">Quick Roll</h3>
      <div class="dice-grid">
        <button class="dice-btn" data-sides="4">d4</button>
        <button class="dice-btn" data-sides="6">d6</button>
        <button class="dice-btn" data-sides="8">d8</button>
        <button class="dice-btn" data-sides="10">d10</button>
        <button class="dice-btn" data-sides="12">d12</button>
        <button class="dice-btn" data-sides="20">d20</button>
        <button class="dice-btn d100" data-sides="100">d100</button>
      </div>
      <div class="dice-result-container">
        <div class="dice-result" id="diceResult">‚Äî</div>
        <div class="dice-history" id="diceHistory"></div>
      </div>
    </section>

    <!-- Quick NPC Generator -->
    <section class="quick-npc-section">
      <button class="btn btn-accent" id="quickNPCBtn">
        <span>üé≠</span>
        <span>Quick NPC</span>
      </button>
    </section>

    <!-- Quick NPC Result -->
    <div class="npc-result-overlay" id="npcResultOverlay">
      <div class="npc-result-card">
        <div class="npc-result-header">
          <span class="npc-result-name" id="quickNPCName">NPC Name</span>
          <button class="btn-icon close-btn" id="closeNPCResult">
            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="npc-result-subtitle" id="quickNPCSubtitle">Race, Occupation</div>
        <div class="npc-result-body" id="quickNPCBody">
          <!-- Filled by JS -->
        </div>
        <div class="npc-result-actions">
          <button class="btn btn-secondary" id="rerollNPCBtn">
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
              <path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
            New NPC
          </button>
          <button class="btn btn-ghost" id="copyQuickNPCBtn">
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
              <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
            </svg>
            Copy
          </button>
        </div>
      </div>
    </div>

    <!-- Quick Links -->
    <section class="quick-links">
      <button class="quick-link-btn" data-table="trinkets">
        <span class="quick-link-icon">üé≤</span>
        <span>Trinket</span>
      </button>
      <button class="quick-link-btn" data-table="wild_magic">
        <span class="quick-link-icon">‚ú®</span>
        <span>Wild Magic</span>
      </button>
      <button class="quick-link-btn" data-table="tavern_drinks">
        <span class="quick-link-icon">üç∫</span>
        <span>Tavern Drink</span>
      </button>
      <button class="quick-link-btn" data-table="npc_quirks">
        <span class="quick-link-icon">üé≠</span>
        <span>NPC Quirk</span>
      </button>
      <button class="quick-link-btn" data-table="loot">
        <span class="quick-link-icon">üí∞</span>
        <span>Loot</span>
      </button>
      <button class="quick-link-btn" data-table="tavern_events">
        <span class="quick-link-icon">üçª</span>
        <span>Tavern Event</span>
      </button>
      <button class="quick-link-btn" data-table="weather">
        <span class="quick-link-icon">üå¶Ô∏è</span>
        <span>Weather</span>
      </button>
      <button class="quick-link-btn" data-table="dungeon_dressing">
        <span class="quick-link-icon">üè∞</span>
        <span>Dungeon Dressing</span>
      </button>
      <button class="quick-link-btn" data-table="corpse_pockets">
        <span class="quick-link-icon">üíÄ</span>
        <span>Corpse Pockets</span>
      </button>
    </section>

    <!-- Table Roll Result -->
    <div class="table-result-overlay" id="tableResultOverlay">
      <div class="table-result-card">
        <div class="table-result-header">
          <span class="table-result-title" id="tableResultTitle">Trinket</span>
          <button class="btn-icon close-btn" id="closeTableResult">
            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="table-result-roll">
          Rolled: <span id="tableRollValue">00</span>
        </div>
        <div class="table-result-text" id="tableResultText">
          <!-- Result text here -->
        </div>
        <div class="table-result-actions">
          <button class="btn btn-secondary reroll-btn" id="rerollBtn">
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
              <path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
            Roll Again
          </button>
        </div>
        <div class="manual-roll-section">
          <label for="manualRollInput">Player rolled:</label>
          <div class="manual-roll-input-group">
            <input type="number" id="manualRollInput" min="1" max="100" placeholder="1-100">
            <button class="btn btn-primary" id="manualRollBtn">Look Up</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="popup-footer">
      <a href="https://www.homebrewdnd.com" target="_blank" class="footer-link">homebrewdnd.com</a>
      <span class="footer-shortcut">Ctrl+Shift+H for full panel</span>
    </footer>
  </div>

  <script src="../shared/utils.js"></script>
  <script src="../shared/npc-generator.js"></script>
  <script src="popup.js"></script>
</body>
</html>